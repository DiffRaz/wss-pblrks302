<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warehouse Storage System</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/icon.png') }}">
  <!-- Linking Google Font Link For Icons -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <form id="form-edit-profil" action="/edit_profile" method="post">
    <div class="content">
      <div class="header">
        <h2>Add Item Request Form - Staff</h2>
        <p>Hello, {{username}}</p>
      </div>
        {% for profils in profil %}
            <label class="input-Nama-klien">EMAIL:</label>
            <input style="padding-left: 140px;" type="text" name="email" id="email" value="{{profils.email}}" required>
            <label class="input-Nama-Barang"><br>password:</label>
            <input style="padding-left: 120px;" type="text" name="password" id="password" required>
            <label class="input-Kode-Barang">CONFIRM PASSWORD:</label>
            <input style="padding-left: 155px;" type="password" name="confirm" id="confirm" required>
            <label class="input-Kode-Barang">DATE:</label>
            <input style="padding-left: 155px;" type="date" name="date" id="date" value="{{profils.date}}" required>
            
            <button type="button" class="cancel-btn">Cancel</button>
            <button type="submit" class="done-btn">Submit</button>


        
    </div>
  </form>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
    <script>
      // Menampilkan SweetAlert berdasarkan pesan
      Swal.fire({
          title: 'Success!',
          text: 'Your profile has been updated successfully.',
          icon: 'success',
          timer: 2000,
          showCancelButton: false,
          showConfirmButton: false
        }).then(() => {
          window.location.href = "{{ url_for(profils.level) }}"; // Redirect to the user's level page
        });


            // Tombol Cancel
      document.querySelector('.cancel-btn').addEventListener('click', function() {
          const level = "{{ profils.level }}"; // Ambil level pengguna dari backend
          Swal.fire({
              title: 'CANCELLED',
              text: 'You have canceled the process.',
              icon: 'info',
              timer: 2000,
              showCancelButton: false,
              showConfirmButton: false
          }).then(() => {
              // Redirect ke halaman dashboard sesuai level
              window.location.href = "{{ url_for(profils.level) }}";
          });
      });
      // Event listener untuk validasi form submission
      document.getElementById('form-edit-profil').addEventListener('submit', function(event) {
          var email = document.getElementById('email').value.trim();
          var password = document.getElementById('password').value.trim();
          var confirm = document.getElementById('confirm').value.trim();
          var date = document.getElementById('date').value.trim();
          
          // Validasi input kosong
          if (!email || !password || !confirm || !date) {
              event.preventDefault();
              Swal.fire({
                  title: 'FAILED',
                  text: 'Every input field must be filled.',
                  icon: 'error',
                  timer: 2000,
                  showCancelButton: false,
                  showConfirmButton: false
              });
              return;
          }
    
          // Validasi kesesuaian password dan confirm password
          if (password !== confirm) {
              event.preventDefault();
              Swal.fire({
                  title: 'FAILED',
                  text: 'Password and Confirm Password must match.',
                  icon: 'error',
                  timer: 2000,
                  showCancelButton: false,
                  showConfirmButton: false
              });
              return;
          }
    
          // Validasi format email sederhana
          var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(email)) {
              event.preventDefault();
              Swal.fire({
                  title: 'FAILED',
                  text: 'Please enter a valid email address.',
                  icon: 'error',
                  timer: 2000,
                  showCancelButton: false,
                  showConfirmButton: false
              });
              return;
          }
      });
    </script>
    {% endif %}
  {% endwith %}
  {% endfor %}
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="logopng">
      <h2>Warehouse Storage 
        <br>System</h2>
    </div>
    
    <ul class="sidebar-links">
      <h4>
        <div class="menu-separator"></div>
      </h4>
      <li>
        <a href="{{ url_for('staff') }}">
          <img src="{{ url_for('static', filename='images/dashboard.png') }}" alt="Manager Image" width="25" height="25">
          <span>Dashboard</span>
        </a>
      </li>
      <li>
       <a href="{{ url_for('list_barang', page=1) }}">
         <img src="{{ url_for('static', filename='images/list.png') }}" alt="Manager Image" width="25" height="25">
        <span>Item List</span>
       </a>
      </li>
      <li>
        <a href="{{ url_for('tambah_barangg') }}">
          <img src="{{ url_for('static', filename='images/add.png') }}" alt="Manager Image" width="25" height="25">
          <span>Add Item</span>
        </a>
      </li>
      <li>
        <a href="{{ url_for('logout') }}">
          <img src="{{ url_for('static', filename='images/logout.png') }}" alt="Manager Image" width="25" height="25">
          <span>Logout</span>
        </a>
      </li>
    </ul>
    
    <div class="user-account">
      <div class="user-profile">
        <img src="{{ url_for('static', filename='images/spate.jpg') }}" alt="mona2">
        <div class="user-detail">
          <h3>{{username}}</h3>
          <span>Staff</span>
        </div>
      </div>
    </div>
  </aside>
</body>
</html>