<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warehouse Storage System</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/icon.png') }}">
  <!-- Linking Google Font Link For Icons -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style1.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="content">
      <div class="header">
        <h2>Profile Management - Staff</h2>
        <p>Hello, {{username}}</p>
      </div>
        {% for profils in profil %}
      <form id='form-edit-profil' action="/edit_profile" method='POST'>
        <h2>Update Profile and/or Change Password</h2>
        <a></br></a>
        <div class="form-group email">
          <label for="email">Your Email Address</label>
          <input type="email" id="email" name="email" placeholder="Enter specified email address" value="{{profils.email}}" required>
        </div>
        <div class="form-group password">
          <label for="password">New Password</label>
          <input type="password" id="password" name="password" placeholder="Enter your new password" required>
          <i id="pass-toggle-btn" class="fa-solid fa-eye-slash"></i>
        </div>
        <div class="form-group password">
          <label for="password">Confirm New Password</label>
          <input type="password" id="confirm" name="confirm" placeholder="Re-enter your new password" required>
          <i id="pass-toggle-btn2" class="fa-solid fa-eye-slash"></i>
        </div>
        <div class="form-group date">
          <label for="date">Your Birth Date</label>
          <input style="padding-right: 14px;" type="date" id="date" name="date" placeholder="Select your date" value="{{profils.date}}" required>
        </div>
        <div class="form-group submit-btn">
          <input type="submit" value="Submit">
        </div>
      </form>
    </div>
  <script>
      const passwordInput = document.getElementById('password');
      const confirmInput = document.getElementById('confirm');
      const passToggleBtn = document.getElementById('pass-toggle-btn');
      const passToggleBtn2 = document.getElementById('pass-toggle-btn2');
      // Toggling password visibility
      passToggleBtn.addEventListener('click', () => {
      // Toggle type of password input
      passwordInput.type = passwordInput.type === "password" ? "text" : "password";
      // Toggle class for the icon
      passToggleBtn.className = passwordInput.type === "password" ? "fa-solid fa-eye-slash" : "fa-solid fa-eye";
      });
      passToggleBtn2.addEventListener('click', () => {
      confirmInput.type = confirmInput.type === "password" ? "text" : "password";
      passToggleBtn2.className = confirmInput.type === "password" ? "fa-solid fa-eye-slash" : "fa-solid fa-eye";
      });
  </script>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
    <script>
      // Menampilkan SweetAlert berdasarkan pesan
      Swal.fire({
          title: 'Success!',
          text: 'Your profile has been updated successfully.',
          icon: 'success',
          timer: 2000,
          showCancelButton: false,
          showConfirmButton: false
        }).then(() => {
          window.location.href = "{{ url_for(profils.level) }}"; // Redirect to the user's level page
        });


            // Tombol Cancel
      document.querySelector('.cancel-btn').addEventListener('click', function() {
          const level = "{{ profils.level }}"; // Ambil level pengguna dari backend
          Swal.fire({
              title: 'CANCELLED',
              text: 'You have canceled the process.',
              icon: 'info',
              timer: 2000,
              showCancelButton: false,
              showConfirmButton: false
          }).then(() => {
              // Redirect ke halaman dashboard sesuai level
              window.location.href = "{{ url_for(profils.level) }}";
          });
      });
      // Event listener untuk validasi form submission
      document.getElementById('form-edit-profil').addEventListener('submit', function(event) {
          var email = document.getElementById('email').value.trim();
          var password = document.getElementById('password').value.trim();
          var confirm = document.getElementById('confirm').value.trim();
          var date = document.getElementById('date').value.trim();
          
          // Validasi input kosong
          if (!email || !password || !confirm || !date) {
              event.preventDefault();
              Swal.fire({
                  title: 'FAILED',
                  text: 'Every input field must be filled.',
                  icon: 'error',
                  timer: 2000,
                  showCancelButton: false,
                  showConfirmButton: false
              });
              return;
          }
    
          // Validasi kesesuaian password dan confirm password
          if (password !== confirm) {
              event.preventDefault();
              Swal.fire({
                  title: 'FAILED',
                  text: 'Password and Confirm Password must match.',
                  icon: 'error',
                  timer: 2000,
                  showCancelButton: false,
                  showConfirmButton: false
              });
              return;
          }
    
          // Validasi format email sederhana
          var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailPattern.test(email)) {
              event.preventDefault();
              Swal.fire({
                  title: 'FAILED',
                  text: 'Please enter a valid email address.',
                  icon: 'error',
                  timer: 2000,
                  showCancelButton: false,
                  showConfirmButton: false
              });
              return;
          }
      });
    </script>
    {% endif %}
  {% endwith %}
  {% endfor %}
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="logopng">
      <h2>Warehouse Storage 
        <br>System</h2>
    </div>
    
    <ul class="sidebar-links">
      <h4>
        <div class="menu-separator"></div>
      </h4>
      <li>
        <a href="{{ url_for('staff') }}">
          <img src="{{ url_for('static', filename='images/dashboard.png') }}" alt="Manager Image" width="25" height="25">
          <span>Dashboard</span>
        </a>
      </li>
      <li>
       <a href="{{ url_for('list_barang', page=1) }}">
         <img src="{{ url_for('static', filename='images/list.png') }}" alt="Manager Image" width="25" height="25">
        <span>Item List</span>
       </a>
      </li>
      <li>
        <a href="{{ url_for('tambah_barangg') }}">
          <img src="{{ url_for('static', filename='images/add.png') }}" alt="Manager Image" width="25" height="25">
          <span>Add Item</span>
        </a>
      </li>
      <li>
        <a href="{{ url_for('logout') }}">
          <img src="{{ url_for('static', filename='images/logout.png') }}" alt="Manager Image" width="25" height="25">
          <span>Logout</span>
        </a>
      </li>
    </ul>
    
    <div class="user-account">
      <div class="user-profile">
        <img src="{{ url_for('static', filename='images/spate.jpg') }}" alt="mona2">
        <div class="user-detail">
          <h3>{{username}}</h3>
          <span>Staff</span>
        </div>
      </div>
    </div>
  </aside>
</body>
</html>